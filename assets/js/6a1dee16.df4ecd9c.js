"use strict";(self.webpackChunkgpu_passthru_info=self.webpackChunkgpu_passthru_info||[]).push([[132],{374:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"dual-gpu-passthru-desktop/Configuring-Libvirt","title":"Configuring Libvirt","description":"Now that we\'ve got the packages installed, you might notice that when you try to open virt-manager, it asks for the root password. To smooth things out, we\'ll need to configuring libvirt, qemu, and virt-manager for adjust permissions so everything runs more seamlessly.","source":"@site/docs/dual-gpu-passthru-desktop/Configuring-Libvirt.mdx","sourceDirName":"dual-gpu-passthru-desktop","slug":"/dual-gpu-passthru-desktop/Configuring-Libvirt","permalink":"/docs/dual-gpu-passthru-desktop/Configuring-Libvirt","draft":false,"unlisted":false,"editUrl":"https://github.com/UmmItC/gpu-passthru/tree/master/docs/dual-gpu-passthru-desktop/Configuring-Libvirt.mdx","tags":[],"version":"current","lastUpdatedBy":"UmmIt","lastUpdatedAt":1748865002000,"sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"tutorialSidebar","previous":{"title":"Installing Required Packages","permalink":"/docs/dual-gpu-passthru-desktop/Install-require-packages"},"next":{"title":"Downloading the Operating System","permalink":"/docs/dual-gpu-passthru-desktop/Download-OS"}}');var r=s(4848),t=s(8453);const o={sidebar_position:10},l="Configuring Libvirt",d={},a=[{value:"Adjust Permissions for <code>virt-manager</code>",id:"adjust-permissions-for-virt-manager",level:2},{value:"Set Up Logging for Troubleshooting (Optional but Recommended)",id:"set-up-logging-for-troubleshooting-optional-but-recommended",level:3},{value:"Add Your User to the <code>libvirt</code> Group",id:"add-your-user-to-the-libvirt-group",level:2},{value:"Enable and Start Libvirt Services",id:"enable-and-start-libvirt-services",level:2},{value:"Verify Group Membership",id:"verify-group-membership",level:3},{value:"QEMU Configuration",id:"qemu-configuration",level:2},{value:"Restart the <code>libvirtd</code> Service",id:"restart-the-libvirtd-service",level:2},{value:"Start <code>virsh</code> Network Automatically - (Optional but Recommended)",id:"start-virsh-network-automatically---optional-but-recommended",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"configuring-libvirt",children:"Configuring Libvirt"})}),"\n",(0,r.jsxs)(n.p,{children:["Now that we've got the packages installed, you might notice that when you try to open ",(0,r.jsx)(n.code,{children:"virt-manager"}),", it asks for the root password. To smooth things out, we'll need to configuring libvirt, qemu, and virt-manager for adjust permissions so everything runs more seamlessly."]}),"\n",(0,r.jsxs)(n.h2,{id:"adjust-permissions-for-virt-manager",children:["Adjust Permissions for ",(0,r.jsx)(n.code,{children:"virt-manager"})]}),"\n",(0,r.jsxs)(n.p,{children:["Here\u2019s how to set up your system so you can use ",(0,r.jsx)(n.code,{children:"virt-manager"})," without constantly needing root access:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Open the configuration file with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo vim /etc/libvirt/libvirtd.conf\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Look for the ",(0,r.jsx)(n.code,{children:"unix_sock_group"})," and ",(0,r.jsx)(n.code,{children:"unix_sock_rw_perms"})," entries in the file. Uncomment these lines and set the values as shown below:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Set ",(0,r.jsx)(n.code,{children:"unix_sock_group"})," to ",(0,r.jsx)(n.code,{children:"libvirt"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'unix_sock_group = "libvirt"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Set ",(0,r.jsx)(n.code,{children:"unix_sock_rw_perms"})," to ",(0,r.jsx)(n.code,{children:"0770"})," to allow the right permissions for ",(0,r.jsx)(n.code,{children:"virt-manager"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'unix_sock_rw_perms = "0770"\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Save and exit by typing ",(0,r.jsx)(n.code,{children:":wq"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This configuration will let you launch and manage ",(0,r.jsx)(n.code,{children:"virt-manager"})," without running into permission problems."]}),"\n",(0,r.jsx)(n.h3,{id:"set-up-logging-for-troubleshooting-optional-but-recommended",children:"Set Up Logging for Troubleshooting (Optional but Recommended)"}),"\n",(0,r.jsxs)(n.p,{children:["If you run into issues with ",(0,r.jsx)(n.code,{children:"virt-manager"}),", having logs can be a lifesaver. To set up logging:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Open the ",(0,r.jsx)(n.code,{children:"/etc/libvirt/libvirtd.conf"})," file again:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo vim /etc/libvirt/libvirtd.conf\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Add these lines at the end of the file to set up logging:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'log_filters="3:qemu 1:libvirt"\nlog_outputs="2:file:/var/log/libvirt/libvirtd.log"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This way, you\u2019ll have detailed logs to help troubleshoot any problems."}),"\n",(0,r.jsxs)(n.h2,{id:"add-your-user-to-the-libvirt-group",children:["Add Your User to the ",(0,r.jsx)(n.code,{children:"libvirt"})," Group"]}),"\n",(0,r.jsxs)(n.p,{children:["To use ",(0,r.jsx)(n.code,{children:"virt-manager"})," without any superuser warnings, add your user to the ",(0,r.jsx)(n.code,{children:"libvirt"})," and ",(0,r.jsx)(n.code,{children:"kvm"})," groups:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Run the following command:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo usermod -a -G kvm,libvirt $(whoami)\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"enable-and-start-libvirt-services",children:"Enable and Start Libvirt Services"}),"\n",(0,r.jsx)(n.p,{children:"Make sure libvirt services start automatically on boot and then start the libvirt service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo systemctl enable libvirtd\nsudo systemctl start libvirtd\n"})}),"\n",(0,r.jsx)(n.h3,{id:"verify-group-membership",children:"Verify Group Membership"}),"\n",(0,r.jsx)(n.p,{children:"Check that your user has been added to the necessary groups:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo groups $(whoami)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This confirms that you\u2019ve successfully added your user to the ",(0,r.jsx)(n.code,{children:"libvirt"})," and ",(0,r.jsx)(n.code,{children:"kvm"})," groups."]}),"\n",(0,r.jsx)(n.h2,{id:"qemu-configuration",children:"QEMU Configuration"}),"\n",(0,r.jsx)(n.p,{children:"To make sure QEMU processes run with your user permissions:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Edit the ",(0,r.jsx)(n.code,{children:"qemu.conf"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo vim /etc/libvirt/qemu.conf\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Tip: In ",(0,r.jsx)(n.code,{children:"vim"}),", you can quickly find ",(0,r.jsx)(n.code,{children:"user ="})," by pressing ",(0,r.jsx)(n.code,{children:"/"}),", typing ",(0,r.jsx)(n.code,{children:"user ="}),", and pressing ",(0,r.jsx)(n.code,{children:"Enter"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Look for these lines:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'user = "libvirt"\ngroup = "libvirt"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Change ",(0,r.jsx)(n.code,{children:'"libvirt"'})," to your username:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'user = "username"\ngroup = "username"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This adjustment ensures QEMU processes run with your user privileges."}),"\n",(0,r.jsxs)(n.h2,{id:"restart-the-libvirtd-service",children:["Restart the ",(0,r.jsx)(n.code,{children:"libvirtd"})," Service"]}),"\n",(0,r.jsxs)(n.p,{children:["Apply your changes by restarting the ",(0,r.jsx)(n.code,{children:"libvirtd"})," service:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo systemctl restart libvirtd\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"start-virsh-network-automatically---optional-but-recommended",children:["Start ",(0,r.jsx)(n.code,{children:"virsh"})," Network Automatically - (Optional but Recommended)"]}),"\n",(0,r.jsx)(n.p,{children:"If you only want to passthrough your LAN or wireless, ignore it's ok."}),"\n",(0,r.jsxs)(n.p,{children:["Every standard libvirt installation provides NAT based connectivity to virtual machines out of the box. This is the so called ",(0,r.jsx)(n.code,{children:"default virtual network"}),"."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["For more: ",(0,r.jsx)(n.a,{href:"https://wiki.libvirt.org/Networking.html",children:"https://wiki.libvirt.org/Networking.html"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sudo virsh net-autostart default\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now, you\u2019ve configured permissions, added your user to the right groups, QEMU settings, and ensured services are running correctly."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);